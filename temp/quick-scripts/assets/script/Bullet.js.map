{"version":3,"sources":["Bullet.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport Common from \"./Common\";\r\n\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Bullet extends cc.Component {\r\n\r\n    // 飞行的方位 (标准化向量)\r\n    direction: cc.Vec2 = null;\r\n\r\n    // 靶标,如何检验呢这个切的number与target的对应性,用no,得到了标靶然后可以得到标靶挂的脚本的数据\r\n    target: cc.Node = null;\r\n\r\n    // 爆炸特效\r\n    explodeEffect: cc.SpriteFrame = null;\r\n\r\n    // 音效\r\n    audioExplode: cc.AudioClip = null;\r\n\r\n    onLoad() {\r\n\r\n    }\r\n\r\n    start() {\r\n        if (this.target == null) { cc.log('未设置靶标 target 属性!'); return; }\r\n        if (this.explodeEffect == null) { cc.log('未设置爆炸特效 explodeEffect 属性!'); return; }\r\n\r\n        this.schedule(this.onTimer, 0.016);\r\n    }\r\n\r\n    onTimer() {\r\n        if (this.node.y > 300)  // 靶标与射击基准之间的距离\r\n        {\r\n            this.unschedule(this.onTimer);\r\n\r\n            if (this.isHit())\r\n                this.success();\r\n            else\r\n                this.failed();\r\n\r\n            return;\r\n        }\r\n\r\n        let speed: number = 15; // 步长\r\n        let dx = speed * this.direction.x;\r\n        let dy = speed * this.direction.y;\r\n\r\n        this.node.x += dx;\r\n        this.node.y += dy;\r\n    }\r\n\r\n    dismiss() {\r\n        this.node.destroy();\r\n    }\r\n\r\n    // 检查是否命中目标,改为碰撞检查?\r\n    isHit(): boolean {\r\n        var flag = 0;//检测类型匹配(number和)target随机出来的把\r\n        //比对\r\n        console.log(\"comm的值是\" + Common.number);//没问题,切的枪\r\n        //有问题的,应该是0\r\n        console.log(\"no的值是\" + Common.no);\r\n        if (Common.no == Common.number) {\r\n            console.log(\"验证成功\");\r\n            flag = 1;\r\n        }\r\n\r\n        let targetPos: cc.Vec2 = this.getWorldLocation(this.target);//有问题\r\n        let selfPos: cc.Vec2 = this.getWorldLocation(this.node);//子弹的世界坐标\r\n        let distance: number = Math.abs(targetPos.x - selfPos.x);  // x方向距离\r\n        // let distance : number = cc.Vec2.distance(targetPos, selfPos);\r\n        cc.log('靶标x=' + targetPos.x + ', 子弹x=' + selfPos.x);\r\n\r\n        if (distance < 50 && flag == 1) return true;\r\n        return false;\r\n    }\r\n\r\n    // 获取一个节点的世界坐标\r\n    getWorldLocation(node: cc.Node): cc.Vec2 {\r\n        let pos = node.getPosition();//相对于父亲(炮塔)来说的\r\n        return node.parent.convertToWorldSpaceAR(pos);//父亲再把这个点转为世界点\r\n    }\r\n\r\n    success() {\r\n        // 此处应添加特效\r\n        this.change_score(10);\r\n        cc.log('命中目标');\r\n        // this.dismiss();   \r\n\r\n        this.explode();\r\n        this.cheer();\r\n\r\n        // 得分,以后就不用那么麻烦去var scr=什么了\r\n        Common.score += 10;\r\n\r\n        // 音效\r\n        if (this.audioExplode != null)\r\n            cc.audioEngine.play(this.audioExplode, false, 1);\r\n    }\r\n\r\n    failed() {\r\n        cc.log('脱靶!');\r\n        this.soud2();\r\n        this.change_score(-5);\r\n        Common.score -= 5;\r\n\r\n        this.uncheer();\r\n        this.dismiss(); // 直接销毁\r\n    }\r\n\r\n    // 爆炸特效\r\n    explode() {\r\n        cc.log('爆炸效果..');\r\n        let sp: cc.Sprite = this.node.getComponent(cc.Sprite);\r\n        sp.spriteFrame = this.explodeEffect;\r\n\r\n        this.node.scale = 0.1;\r\n\r\n        let self = this;\r\n        cc.tween(this.node)\r\n            .to(0.4, { scale: 1 })\r\n            .to(0.2, { opacity: 0 })\r\n            .call(function () { self.dismiss(); })\r\n            .start();\r\n    }\r\n\r\n    // 加分效果\r\n    cheer() {\r\n        let labelNode: cc.Node = new cc.Node();\r\n        let label: cc.Label = labelNode.addComponent(cc.Label);\r\n        label.string = \"+10分\";\r\n        labelNode.color = new cc.Color(255, 0, 255);\r\n        labelNode.parent = this.node.parent;\r\n        labelNode.setPosition(cc.v3(0, 250, 0));\r\n        labelNode.opacity = 200;\r\n\r\n        cc.tween(labelNode)\r\n            .to(0.5, { scale: 1.5 })\r\n            .to(0.2, { opacity: 0 })\r\n            .call(function () { labelNode.destroy(); })\r\n            .start();\r\n    }\r\n    uncheer() {\r\n        let labelNode: cc.Node = new cc.Node();\r\n        let label: cc.Label = labelNode.addComponent(cc.Label);\r\n        label.string = \"-5分\";\r\n        labelNode.color = new cc.Color(255, 0, 0);\r\n        labelNode.parent = this.node.parent;\r\n        labelNode.setPosition(cc.v3(0, 250, 0));\r\n        labelNode.opacity = 200;\r\n\r\n        cc.tween(labelNode)\r\n            .to(0.5, { scale: 1.5 })\r\n            .to(0.2, { opacity: 0 })\r\n            .call(function () { labelNode.destroy(); })\r\n            .start();\r\n    }\r\n    // onCollisionEnter() {\r\n    //     cc.log(\"调用撞到了\");\r\n    // }\r\n    soud2() {\r\n        var node = cc.find('其他/music/无子弹').getComponent(cc.AudioSource);\r\n        node.play();\r\n    }\r\n    change_score(a: number) {\r\n        var node = cc.find(\"Canvas/得分/分数\");\r\n        node.getComponent(cc.Label).string = Common.score + a + \"分\";\r\n\r\n    }\r\n}\r\n"]}