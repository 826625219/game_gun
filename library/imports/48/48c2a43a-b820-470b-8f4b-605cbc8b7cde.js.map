{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\Cannon.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport Bullet from \"./Bullet\";\r\nimport Common from \"./Common\";\r\nimport Magazine from \"./Magazine\";\r\n\r\n\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class NewClass extends cc.Component {\r\n\r\n    // 子弹图片\r\n\r\n    @property([cc.SpriteFrame])\r\n    public myNodes: cc.SpriteFrame[] = [];\r\n\r\n    // 爆炸特效\r\n    @property(cc.SpriteFrame)\r\n    explodeEffect: cc.SpriteFrame = null;\r\n\r\n    // 音效\r\n    @property(cc.AudioClip)\r\n    audioFire: cc.AudioClip = null;\r\n    @property(cc.AudioClip)\r\n    audioExplode: cc.AudioClip = null;\r\n\r\n    // 炮塔图片\r\n    @property(cc.SpriteFrame)\r\n    iconNormal: cc.SpriteFrame = null;\r\n    @property(cc.SpriteFrame)\r\n    iconActive: cc.SpriteFrame = null;\r\n\r\n    // 内部属性    \r\n    startPos: cc.Vec2 = null;\r\n    startAngle: number = null;\r\n    flag = 1;\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad() {\r\n\r\n        let a = window[\"data\"];\r\n        if (a.datas == 1) {\r\n            Common.time = 100;\r\n            //  a.datas = null;\r\n        }\r\n        if (a.datas == 2) {\r\n            Common.time = 80;//难道是用了这个?\r\n            //   a.datas = null;\r\n\r\n        }\r\n        if (a.datas == 3) {\r\n            Common.time = 60;\r\n            // a.datas = null;\r\n\r\n        }\r\n        var node1 = cc.find(\"Canvas/结果提示框\");\r\n        node1.active = false;\r\n\r\n\r\n        //只在这里开会不会其他地方没接受到呢\r\n        // var manager = cc.director.getCollisionManager();\r\n        // manager.enabled = true;\r\n        // 初始角度设为90度\r\n        this.node.angle = 90;\r\n        //因为只挂在这个炮塔的节点下面所以才会对触摸时间炮塔有影响\r\n        this.node.on('touchstart', this.onTouchStart, this);//开始触摸\r\n        this.node.on('touchmove', this.onTouchMove, this);//触摸移动控制炮塔方向\r\n        this.node.on('touchend', this.onTouchEnd, this);//发射\r\n        this.node.on('touchcancel', this.onTouchEnd, this);//?\r\n    }\r\n\r\n    start() {\r\n        this.schedule(this.onTimer, 1);\r\n    }\r\n    onTimer() {\r\n        Common.time--;\r\n        var node = cc.find(\"Canvas/倒计时/时间\");\r\n        node.getComponent(cc.Label).string = Common.time + 's';\r\n        if (Common.time == 0)  // 靶标与射击基准之间的距离\r\n        {\r\n            this.unschedule(this.onTimer);\r\n            return;\r\n        }\r\n    }\r\n    onTimer1() {\r\n        var time = 2;\r\n        time--;\r\n        console.log(\"time为\" + time);\r\n        // var node = cc.find(\"Canvas/倒计时/时间\");\r\n        // node.getComponent(cc.Label).string = Common.time + 's';\r\n        if (time == 1)  // 靶标与射击基准之间的距离\r\n        {\r\n            Common.resultDialog.showresult();\r\n            Common.resultDialog.show();\r\n            cc.director.pause();\r\n            this.unschedule(this.onTimer1);\r\n            return;\r\n        }\r\n    }\r\n\r\n    update(dt) {\r\n        if (this.flag == 1 && Common.time == 0) {\r\n            console.log(\"子弹完了\");\r\n            this.flag = 0;\r\n\r\n            //不然就计时器拖延时间给它赋值 \r\n            //   this.schedule(this.onTimer1, 1);\r\n            Common.resultDialog.showresult();\r\n            Common.resultDialog.show();\r\n            cc.director.pause();\r\n        }\r\n        if ((Common.magazine.count <= 0) && (Common.magazine1.count <= 0) && (Common.magazine2.count <= 0)) {\r\n            this.flag = 0;\r\n            this.schedule(this.onTimer1, 1);\r\n\r\n        }\r\n    }\r\n\r\n    onTouchStart(e: cc.Event.EventTouch) {\r\n        //把this.node改一下不就好了..\r\n        // startPos : 触点开始的位置\r\n        var node = cc.find('其他/music/蓄力').getComponent(cc.AudioSource);\r\n        node.play();\r\n        this.startPos = this.node.parent.convertToNodeSpaceAR(e.getLocation());\r\n        // startAngle : 炮口的初始角度 (x轴方向为0度)\r\n        this.startAngle = this.node.angle;\r\n\r\n        // 激发时的图片显示\r\n        this.node.getComponent(cc.Sprite).spriteFrame = this.iconActive;\r\n    }\r\n\r\n    onTouchMove(e: cc.Event.EventTouch) {\r\n        // 触点的当前位置\r\n        let pos = this.node.parent.convertToNodeSpaceAR(e.getLocation());\r\n\r\n        // 摆动的角度 a.signAngle(b) 即 a向量与b向量之前的夹角(弧度)\r\n        let sweep_radian = pos.signAngle(this.startPos);\r\n        let sweep_angle = 180 * sweep_radian / Math.PI; // 弧度radian -> 角度 angle\r\n\r\n        // 炮口的新指向\r\n        // 比如，原来炮口90度，向右摆动15度，则炮口应指向75度\r\n        let angle = this.startAngle - sweep_angle;\r\n        // 炮口角度限制在45~135度之间\r\n        if (angle < 45) angle = 30;\r\n        if (angle > 135) angle = 150;\r\n\r\n        //cc.log(\"炮口摆动: \" + sweep_angle + ', 修正后的角度: ' + angle);\r\n\r\n        this.node.angle = angle;\r\n    }\r\n\r\n    onTouchEnd(e: cc.Event.EventTouch) {\r\n\r\n        // this.fire();\r\n\r\n        // 普通状态的图片显示\r\n        this.node.getComponent(cc.Sprite).spriteFrame = this.iconNormal;\r\n    }\r\n\r\n    // 开火\r\n    fire() {\r\n        if (Common.number == 1) {//看还有没有子弹\r\n            var node1 = cc.find('Canvas/弹仓1').getComponent(\"Magazine1\");\r\n            if (node1.count == 0) {\r\n                this.soud2();\r\n                var node = cc.find('其他/music/无子弹').getComponent(cc.AudioSource);\r\n                node.play();\r\n                return;\r\n\r\n            }\r\n        }\r\n        if (Common.number == 0) {//看还有没有子弹\r\n            var node1 = cc.find('Canvas/弹仓').getComponent(\"Magazine\");\r\n            if (node1.count == 0) {\r\n                this.soud2();\r\n                var node = cc.find('其他/music/无子弹').getComponent(cc.AudioSource);\r\n                node.play();\r\n                return;\r\n\r\n            }\r\n        }\r\n        if (Common.number == 2) {//看还有没有子弹\r\n            var node1 = cc.find('Canvas/弹仓2').getComponent(\"Magazine2\");\r\n            if (node1.count == 0) {\r\n                this.soud2();\r\n                var node = cc.find('其他/music/无子弹').getComponent(cc.AudioSource);\r\n                node.play();\r\n                return;\r\n\r\n            }\r\n        }\r\n        if (this.myNodes[Common.number] == null) { cc.log('请设置bulletIcon图片'); return; }\r\n\r\n        // 炮口的指向，应是子弹的运行方向\r\n        let angle: number = this.node.angle; // 子弹运行的方向 \r\n        let radian = angle * Math.PI / 180;\r\n        let direction = cc.v2(Math.cos(radian), Math.sin(radian)); // 标准化向量\r\n\r\n        // 动态创建一个子弹Node，添加Sprite组件\r\n        let bulletNode: cc.Node = new cc.Node();\r\n        // bulletNode.group = \"子弹\";//添加动态碰撞,无法edit碰撞边缘...,可以动态加一个碰撞组件,等下试试看\r\n        let sprite: cc.Sprite = bulletNode.addComponent(cc.Sprite);\r\n        sprite.spriteFrame = this.myNodes[Common.number];   // 设置子弹的图片     \r\n\r\n        bulletNode.parent = this.node.parent; // 指定父节点\r\n\r\n        // 角度及初始位置  \r\n        bulletNode.angle = this.node.angle; // 子弹的角度\r\n        let r = 120; // 子弹与射击基准的距离\r\n        let bullet_x = r * direction.x;//rcosx\r\n        let bullet_y = r * direction.y;\r\n        bulletNode.setPosition(cc.v3(bullet_x, bullet_y, 0));    // 子弹的初始位置       \r\n\r\n        // // 给子弹附加脚本组件\r\n        // let bullet: Bullet  = bulletNode.addComponent( Bullet );\r\n        // bullet.direction = direction; // 子弹的飞行方向\r\n        // 给子弹附加脚本组件\r\n        let bullet: Bullet = bulletNode.addComponent(Bullet);//bulletNode下挂一个脚本Bullet,返回脚本\r\n        bullet.direction = direction;\r\n        //根据枪来找靶子,动态绑定,不可以在这更新的\r\n        if (Common.no == 0)\r\n            bullet.target = cc.find('Canvas/靶子');\r\n\r\n        if (Common.no == 1)//如果玩家知道切的换就会正确绑定啊!\r\n            bullet.target = cc.find('Canvas/靶子1');\r\n\r\n        if (Common.no == 2)\r\n            bullet.target = cc.find('Canvas/靶子2');\r\n\r\n        bullet.explodeEffect = this.explodeEffect; // 爆炸特效\r\n        bullet.audioExplode = this.audioExplode;\r\n\r\n        // let magazine : Magazine = cc.find('Canvas/弹仓').getComponent('Magazine');\r\n        // magazine.consume(1);\r\n        if (Common.number == 0) {\r\n            Common.magazine.consume(1);\r\n            console.log(Common.magazine.count);\r\n        }\r\n\r\n        if (Common.number == 1) {\r\n            Common.magazine1.consume(1);\r\n            console.log(Common.magazine1.count);\r\n        }\r\n        if (Common.number == 2) {\r\n            Common.magazine2.consume(1);\r\n            console.log(Common.magazine2.count);\r\n        }\r\n\r\n\r\n        // 音效\r\n        if (this.audioFire != null)\r\n            cc.audioEngine.play(this.audioFire, false, 1);\r\n    }\r\n    soud2() {\r\n        var node = cc.find('其他/music/无子弹').getComponent(cc.AudioSource);\r\n        node.play();\r\n    }\r\n\r\n}\r\n"]}